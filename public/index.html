<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>–ú–∞–≥–∏—Å—Ç—Ä–∞–Ω—Ç—Ç–∞—Ä–¥—ã“£ —Ç–∞“õ—ã—Ä—ã–ø —Ç–∞“£–¥–∞—É—ã</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f8f9fa;
    }
    h1 {
      color: #2c3e50;
    }
    .hidden {
      display: none;
    }
    .error {
      color: red;
    }
    .form-box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    input {
      width: 100%;
      padding: 8px;
      margin: 6px 0 12px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      padding: 10px 15px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
    }
    button:hover {
      background: #0056b3;
    }
    .center-block {
      margin-bottom: 25px;
      padding: 15px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .topic {
      margin: 5px 0;
      padding: 8px;
      border-radius: 5px;
      cursor: pointer;
    }
    .taken {
      background: #f8d7da;
      color: #721c24;
    }
    .free {
      background: #d4edda;
      color: #155724;
    }
  </style>
</head>
<body>
  <h1>üéì –ú–∞–≥–∏—Å—Ç—Ä–∞–Ω—Ç—Ç–∞—Ä–¥—ã“£ —Ç–∞“õ—ã—Ä—ã–ø —Ç–∞“£–¥–∞—É –∂“Ø–π–µ—Å—ñ</h1>

  <!-- –õ–æ–≥–∏–Ω —Ñ–æ—Ä–º–∞ -->
  <div id="loginForm" class="form-box">
    <label>–§–ò–û:</label>
    <input type="text" id="fio" placeholder="–¢–æ–ª—ã“õ –∞—Ç—ã-–∂”©–Ω—ñ“£—ñ–∑–¥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑">

    <label>–ò–ò–ù:</label>
    <input type="password" id="iin" placeholder="–ò–ò–ù –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑">

    <button onclick="login()">–ö—ñ—Ä—É</button>
    <p class="error" id="loginError"></p>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é -->
  <div id="main" class="hidden">
    <h2>üìö –û—Ä—Ç–∞–ª—ã“õ—Ç–∞—Ä –∂”ô–Ω–µ —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä</h2>
    <div id="centers"></div>
  </div>

  <script>
    const socket = io();
    let currentFio = null;

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    function login() {
      const fio = document.getElementById("fio").value.trim();
      const iin = document.getElementById("iin").value.trim();

      if (!fio || !iin) {
        document.getElementById("loginError").textContent = "‚ö†Ô∏è –§–ò–û –∂”ô–Ω–µ –ò–ò–ù –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑!";
        return;
      }
      socket.emit("registerStudent", { fio, iin });
      currentFio = fio;
    }

    // –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    socket.on("authError", msg => {
      document.getElementById("loginError").textContent = msg;
    });

    // –ü–æ–ª—É—á–∏–ª–∏ —Å–ø–∏—Å–æ–∫ —Ç–µ–º
    socket.on("topicsList", centers => {
      document.getElementById("loginForm").classList.add("hidden");
      document.getElementById("main").classList.remove("hidden");

      const container = document.getElementById("centers");
      container.innerHTML = "";

      centers.forEach(center => {
        const block = document.createElement("div");
        block.className = "center-block";
        block.innerHTML = `<h3>${center.name}</h3>`;

        center.topics.forEach(topic => {
          const div = document.createElement("div");
          div.className = "topic " + (topic.student ? "taken" : "free");
          div.textContent = `${topic.id}. ${topic.title} ${topic.student ? " ‚Äî " + topic.student : ""}`;

          // –ú–æ–∂–Ω–æ –∫–ª–∏–∫–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–µ–º–∞ —Å–≤–æ–±–æ–¥–Ω–∞
          if (!topic.student) {
            div.onclick = () => {
              socket.emit("chooseTopic", {
                fio: currentFio,
                centerName: center.name,
                topicId: topic.id
              });
            };
          }
          block.appendChild(div);
        });
        container.appendChild(block);
      });
    });

    // –û—à–∏–±–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã
    socket.on("topicError", msg => {
      alert(msg);
    });
  </script>
</body>
</html>
